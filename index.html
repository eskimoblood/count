<!doctype html>
<html lang="en" class="no-js">
<head>
	<meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<title>counting days</title>
	<meta name="description" content="days and days and days"><meta name="author" content="Leander Herzog">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href='http://fonts.googleapis.com/css?family=Shadows+Into+Light&v2' rel='stylesheet' type='text/css'>	
	<script>
	window.Modernizr=function(a,b,c){function G(){e.input=function(a){for(var b=0,c=a.length;b<c;b++)t[a[b]]=!!(a[b]in l);return t}("autocomplete autofocus list placeholder max min multiple pattern required step".split(" ")),e.inputtypes=function(a){for(var d=0,e,f,h,i=a.length;d<i;d++)l.setAttribute("type",f=a[d]),e=l.type!=="text",e&&(l.value=m,l.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(f)&&l.style.WebkitAppearance!==c?(g.appendChild(l),h=b.defaultView,e=h.getComputedStyle&&h.getComputedStyle(l,null).WebkitAppearance!=="textfield"&&l.offsetHeight!==0,g.removeChild(l)):/^(search|tel)$/.test(f)||(/^(url|email)$/.test(f)?e=l.checkValidity&&l.checkValidity()===!1:/^color$/.test(f)?(g.appendChild(l),g.offsetWidth,e=l.value!=m,g.removeChild(l)):e=l.value!=m)),s[a[d]]=!!e;return s}("search tel url email datetime date month week time datetime-local number range color".split(" "))}function F(a,b){var c=a.charAt(0).toUpperCase()+a.substr(1),d=(a+" "+p.join(c+" ")+c).split(" ");return!!E(d,b)}function E(a,b){for(var d in a)if(k[a[d]]!==c&&(!b||b(a[d],j)))return!0}function D(a,b){return(""+a).indexOf(b)!==-1}function C(a,b){return typeof a===b}function B(a,b){return A(o.join(a+";")+(b||""))}function A(a){k.cssText=a}var d="1.7",e={},f=!0,g=b.documentElement,h=b.head||b.getElementsByTagName("head")[0],i="modernizr",j=b.createElement(i),k=j.style,l=b.createElement("input"),m=":)",n=Object.prototype.toString,o=" -webkit- -moz- -o- -ms- -khtml- ".split(" "),p="Webkit Moz O ms Khtml".split(" "),q={svg:"http://www.w3.org/2000/svg"},r={},s={},t={},u=[],v,w=function(a){var c=b.createElement("style"),d=b.createElement("div"),e;c.textContent=a+"{#modernizr{height:3px}}",h.appendChild(c),d.id="modernizr",g.appendChild(d),e=d.offsetHeight===3,c.parentNode.removeChild(c),d.parentNode.removeChild(d);return!!e},x=function(){function d(d,e){e=e||b.createElement(a[d]||"div");var f=(d="on"+d)in e;f||(e.setAttribute||(e=b.createElement("div")),e.setAttribute&&e.removeAttribute&&(e.setAttribute(d,""),f=C(e[d],"function"),C(e[d],c)||(e[d]=c),e.removeAttribute(d))),e=null;return f}var a={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};return d}(),y=({}).hasOwnProperty,z;C(y,c)||C(y.call,c)?z=function(a,b){return b in a&&C(a.constructor.prototype[b],c)}:z=function(a,b){return y.call(a,b)},r.flexbox=function(){function c(a,b,c,d){a.style.cssText=o.join(b+":"+c+";")+(d||"")}function a(a,b,c,d){b+=":",a.style.cssText=(b+o.join(c+";"+b)).slice(0,-b.length)+(d||"")}var d=b.createElement("div"),e=b.createElement("div");a(d,"display","box","width:42px;padding:0;"),c(e,"box-flex","1","width:10px;"),d.appendChild(e),g.appendChild(d);var f=e.offsetWidth===42;d.removeChild(e),g.removeChild(d);return f},r.canvas=function(){var a=b.createElement("canvas");return a.getContext&&a.getContext("2d")},r.canvastext=function(){return e.canvas&&C(b.createElement("canvas").getContext("2d").fillText,"function")},r.webgl=function(){return!!a.WebGLRenderingContext},r.touch=function(){return"ontouchstart"in a||w("@media ("+o.join("touch-enabled),(")+"modernizr)")},r.geolocation=function(){return!!navigator.geolocation},r.postmessage=function(){return!!a.postMessage},r.websqldatabase=function(){var b=!!a.openDatabase;return b},r.indexedDB=function(){for(var b=-1,c=p.length;++b<c;){var d=p[b].toLowerCase();if(a[d+"_indexedDB"]||a[d+"IndexedDB"])return!0}return!1},r.hashchange=function(){return x("hashchange",a)&&(b.documentMode===c||b.documentMode>7)},r.history=function(){return !!(a.history&&history.pushState)},r.draganddrop=function(){return x("dragstart")&&x("drop")},r.websockets=function(){return"WebSocket"in a},r.rgba=function(){A("background-color:rgba(150,255,150,.5)");return D(k.backgroundColor,"rgba")},r.hsla=function(){A("background-color:hsla(120,40%,100%,.5)");return D(k.backgroundColor,"rgba")||D(k.backgroundColor,"hsla")},r.multiplebgs=function(){A("background:url(//:),url(//:),red url(//:)");return(new RegExp("(url\\s*\\(.*?){3}")).test(k.background)},r.backgroundsize=function(){return F("backgroundSize")},r.borderimage=function(){return F("borderImage")},r.borderradius=function(){return F("borderRadius","",function(a){return D(a,"orderRadius")})},r.boxshadow=function(){return F("boxShadow")},r.textshadow=function(){return b.createElement("div").style.textShadow===""},r.opacity=function(){B("opacity:.55");return/^0.55$/.test(k.opacity)},r.cssanimations=function(){return F("animationName")},r.csscolumns=function(){return F("columnCount")},r.cssgradients=function(){var a="background-image:",b="gradient(linear,left top,right bottom,from(#9f9),to(white));",c="linear-gradient(left top,#9f9, white);";A((a+o.join(b+a)+o.join(c+a)).slice(0,-a.length));return D(k.backgroundImage,"gradient")},r.cssreflections=function(){return F("boxReflect")},r.csstransforms=function(){return!!E(["transformProperty","WebkitTransform","MozTransform","OTransform","msTransform"])},r.csstransforms3d=function(){var a=!!E(["perspectiveProperty","WebkitPerspective","MozPerspective","OPerspective","msPerspective"]);a&&"webkitPerspective"in g.style&&(a=w("@media ("+o.join("transform-3d),(")+"modernizr)"));return a},r.csstransitions=function(){return F("transitionProperty")},r.fontface=function(){var a,c,d=h||g,e=b.createElement("style"),f=b.implementation||{hasFeature:function(){return!1}};e.type="text/css",d.insertBefore(e,d.firstChild),a=e.sheet||e.styleSheet;var i=f.hasFeature("CSS2","")?function(b){if(!a||!b)return!1;var c=!1;try{a.insertRule(b,0),c=/src/i.test(a.cssRules[0].cssText),a.deleteRule(a.cssRules.length-1)}catch(d){}return c}:function(b){if(!a||!b)return!1;a.cssText=b;return a.cssText.length!==0&&/src/i.test(a.cssText)&&a.cssText.replace(/\r+|\n+/g,"").indexOf(b.split(" ")[0])===0};c=i('@font-face { font-family: "font"; src: url(data:,); }'),d.removeChild(e);return c},r.video=function(){var a=b.createElement("video"),c=!!a.canPlayType;if(c){c=new Boolean(c),c.ogg=a.canPlayType('video/ogg; codecs="theora"');var d='video/mp4; codecs="avc1.42E01E';c.h264=a.canPlayType(d+'"')||a.canPlayType(d+', mp4a.40.2"'),c.webm=a.canPlayType('video/webm; codecs="vp8, vorbis"')}return c},r.audio=function(){var a=b.createElement("audio"),c=!!a.canPlayType;c&&(c=new Boolean(c),c.ogg=a.canPlayType('audio/ogg; codecs="vorbis"'),c.mp3=a.canPlayType("audio/mpeg;"),c.wav=a.canPlayType('audio/wav; codecs="1"'),c.m4a=a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/aac;"));return c},r.localstorage=function(){try{return!!localStorage.getItem}catch(a){return!1}},r.sessionstorage=function(){try{return!!sessionStorage.getItem}catch(a){return!1}},r.webWorkers=function(){return!!a.Worker},r.applicationcache=function(){return!!a.applicationCache},r.svg=function(){return!!b.createElementNS&&!!b.createElementNS(q.svg,"svg").createSVGRect},r.inlinesvg=function(){var a=b.createElement("div");a.innerHTML="<svg/>";return(a.firstChild&&a.firstChild.namespaceURI)==q.svg},r.smil=function(){return!!b.createElementNS&&/SVG/.test(n.call(b.createElementNS(q.svg,"animate")))},r.svgclippaths=function(){return!!b.createElementNS&&/SVG/.test(n.call(b.createElementNS(q.svg,"clipPath")))};for(var H in r)z(r,H)&&(v=H.toLowerCase(),e[v]=r[H](),u.push((e[v]?"":"no-")+v));e.input||G(),e.crosswindowmessaging=e.postmessage,e.historymanagement=e.history,e.addTest=function(a,b){a=a.toLowerCase();if(!e[a]){b=!!b(),g.className+=" "+(b?"":"no-")+a,e[a]=b;return e}},A(""),j=l=null,f&&a.attachEvent&&function(){var a=b.createElement("div");a.innerHTML="<elem></elem>";return a.childNodes.length!==1}()&&function(a,b){function p(a,b){var c=-1,d=a.length,e,f=[];while(++c<d)e=a[c],(b=e.media||b)!="screen"&&f.push(p(e.imports,b),e.cssText);return f.join("")}function o(a){var b=-1;while(++b<e)a.createElement(d[b])}var c="abbr|article|aside|audio|canvas|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",d=c.split("|"),e=d.length,f=new RegExp("(^|\\s)("+c+")","gi"),g=new RegExp("<(/*)("+c+")","gi"),h=new RegExp("(^|[^\\n]*?\\s)("+c+")([^\\n]*)({[\\n\\w\\W]*?})","gi"),i=b.createDocumentFragment(),j=b.documentElement,k=j.firstChild,l=b.createElement("body"),m=b.createElement("style"),n;o(b),o(i),k.insertBefore(m,k.firstChild),m.media="print",a.attachEvent("onbeforeprint",function(){var a=-1,c=p(b.styleSheets,"all"),k=[],o;n=n||b.body;while((o=h.exec(c))!=null)k.push((o[1]+o[2]+o[3]).replace(f,"$1.iepp_$2")+o[4]);m.styleSheet.cssText=k.join("\n");while(++a<e){var q=b.getElementsByTagName(d[a]),r=q.length,s=-1;while(++s<r)q[s].className.indexOf("iepp_")<0&&(q[s].className+=" iepp_"+d[a])}i.appendChild(n),j.appendChild(l),l.className=n.className,l.innerHTML=n.innerHTML.replace(g,"<$1font")}),a.attachEvent("onafterprint",function(){l.innerHTML="",j.removeChild(l),j.appendChild(n),m.styleSheet.cssText=""})}(a,b),e._enableHTML5=f,e._version=d,g.className=g.className.replace(/\bno-js\b/,"")+" js "+u.join(" ");return e}(this,this.document)
	</script>
</head>
<body>
	<div id="container">
		<header></header>
		<div id="main" role="main">
		  <form id="userinput" action="/count/" method="get" enctype="application/x-www-form-urlencoded">
      <select id="m" name="m"> <option value="01">January</option> <option value="02">February</option> <option value="03">March</option> <option
      value="04">April</option> <option value="05">May</option> <option value="06">June</option> <option value="07">July</option> <option
      value="08">August</option> <option value="09">September</option> <option value="10">October</option> <option value="11">November</option> <option
      value="12">December</option> </select>
      <select id="d" name="d"></select>
      <select id="y" name="y"></select>
      <input id="name" name="msg" type="text" maxlength="500" value="days on earth."/>
      <input type="submit" value="Go"/>
      </form>
      <p id="string">preview</p>
  		<canvas width="700" height="100" id="myCanvas"> <p>#fail</p> </canvas>
		</div>
<a id="fork" href="http://github.com/lennyjpg/count/" rel="noreferrer"><img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub"></a><footer></footer>
	</div>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
	<style>
	#shorturl{text-align:center;width: 100%;height: 80px;margin: 0px auto 50px;padding: 0px;}
	a{font-size:26px;text-decoration:none;color:#CCC;}
	a:hover{color:#333!important}
	#userinput{display:none;}
	#extra{width: 94%;padding: 0px 50px 0px 0px;color:#333}
	body{padding: 0px;margin:0px;width: 100%;overflow-x:hidden;font-family:'Shadows Into Light'}
	p{font-size: 26px;position: absolute;}
	form{width: 100%;min-height: 100px;text-align:center;margin: 0px 0px;margin: 20px;}
	#string{display:none;margin: 0px auto;width: 100%; height:auto;text-align:center;font-size: 160%;}
	footer{text-align:center;padding: 20px;}
	</style>
	<script>
	var totalmarks=0;
	var context;
  var offset=0;
  var name;
  function getUrlVars(){
      var vars = [], hash;
      var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
      for(var i = 0; i < hashes.length; i++){ hash = hashes[i].split('='); vars.push(hash[0]); vars[hash[0]] = hash[1]; }
      return vars;
  }
function getDays(k){ var diff = new Date()-new Date(k); return Math.round(diff / 1000 / (60 * 60 * 24)); }
function html_entity_decode(str) {
var ta=document.createElement("textarea");
ta.innerHTML=str.replace(/</g,"&lt;").replace(/>/g,"&gt;");
return ta.value;
}
  function clickclack(k,msg){
    	var num = k;
    	var w=$(window).get(0).innerWidth-10;
    	var p=Array();
    	var rand=20;
    	var x=rand; 
    	var y=rand;
    	for(var i=0;i<num;i++){
    		x+=4;
    		if(Math.random()<0.05)y+=Math.random()*2.0;
    		if(Math.random()<0.05)y+=Math.random()-1;
    		if(i>4 && i%5==0){
    			x+=Math.random()*8+8;
    			if(x > w-rand*(Math.random()*4.0+2)){
    				x=rand+Math.random()*20;
    				y+=30+Math.random()*10.0;
    			}
    		}
    		if((i+1)%5==0)close=true;
    		else close=false;
    		p.push([x,y,close]);
    	}
    	var canvas = $("#myCanvas"); 
    	context = canvas.get(0).getContext("2d");
    	context.lineJoin = "round";
    	canvas.attr("width", w); canvas.attr("height", y+200);	
    	for(var i=0;i<num;i++){ 
    	  if(Math.random()<0.1)offset=(Math.random()*60.0-30)/180.0*Math.PI;
  			else offset=0;
    	  mark(p[i][0],p[i][1],p[i][2]); }

    	$('#container').append('<p id="extra">'+msg+'</p>');
    	var ww=$('#extra').width();
    	var posx = x-10;
    	var ypos=y-30;
      $('#extra').css('top',ypos+'px').css('left','30px').css('text-indent',posx+'px');
      $('footer').append('<div id="shorturl"><a href="/count/">Make new!</a></div>');
  }
  
  function mark(x,y,close){
    totalmarks++;
  	var step=4.0;
  	var l=Math.random()*10.0+16;
  	var angle=(Math.random()*16.0-8)/180.0*Math.PI;
  	angle+=offset;
  	var startX=x+Math.random()*2.0;
  	var startY=y+Math.random()*8.0;
  	context.lineWidth=Math.random()*.8+1;
  	context.globalAlpha= Math.random()+0.7;
  	context.beginPath();
  	if(close){
  		var step=5.0;
  		startY+=Math.random()*6.0;
  		angle-=(Math.random()*20.0+50)/180.0*Math.PI;
  	}
  	var tmpX=startX;
  	var tmpY=startY;
  	var res=Math.random()*3+4;
  	for(var i=0;i<res;i++){
  		context.lineTo(tmpX,tmpY);
  		tmpX+=Math.sin(angle)*step;
  		tmpY+=Math.cos(angle)*step;
  		angle+=Math.random()*0.2-0.1;
  	}
  	context.stroke();
  }
  function getQueryVariable(variable) {
    var query = window.location.search.substring(1);
    var vars = query.split("&");
    for (var i=0;i<vars.length;i++) {
      var pair = vars[i].split("=");
      if (pair[0] == variable) { return pair[1]; }
    }
    alert('Query Variable ' + variable + ' not found');
  }
  
  function setPreview(days){
    name=$('#name').val();
    $('#string').text(days+" "+name);
  }
  
  function showData(){
      var mm=getUrlVars()['m'];
    	var dd=getUrlVars()['d'];
    	var yy=getUrlVars()['y'];
    	var msg=decodeURI(unescape(getUrlVars()['msg'].replace(/\+/g, " ")));
    	msg = $("<div/>").html(msg).text();
    	var numberOfDays=getDays(mm+"/"+dd+"/"+yy)
    	clickclack(numberOfDays,msg);    	
    	$('#fork').hide();
  }
  function showForm(){
    var years="";
    for(var i=0;i<100;i++)years+='<option value="'+(2011-i)+'">'+(2011-i)+'</option>';
    $('#y').append(years);
    var days="";
    for(var i=1;i<32;i++)days+='<option value="'+i+'">'+i+'</option>';
    $('#d').append(days);
    var mm=$('#m').val();
  	var dd=$('#d').val();
  	var yy=$('#y').val();
  	setPreview( getDays(mm+"/"+dd+"/"+yy) );
  	$('#userinput').show();
	  $('#string').show();
  }
  
  $(document).ready(function() {	
    var params=getUrlVars().length;
    if(params>3){showData();}
    else{showForm();}
    $('#userinput').change(function() {
      var mm=$('#m').val(); var dd=$('#d').val(); var yy=$('#y').val();
      setPreview( getDays(mm+"/"+dd+"/"+yy) );
     })
     $('#name').change(function() {
      var mm=$('#m').val(); var dd=$('#d').val(); var yy=$('#y').val();
      setPreview( getDays(mm+"/"+dd+"/"+yy) );
     });

  });
  
;(function($,undefined){var tag2attr={a:'href',img:'src',form:'action',base:'href',script:'src',iframe:'src',link:'href'},key=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","fragment"],aliases={"anchor":"fragment"},parser={strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},querystring_parser=/(?:^|&|;)([^&=;]*)=?([^&;]*)/g,fragment_parser=/(?:^|&|;)([^&=;]*)=?([^&;]*)/g;function parseUri(url,strictMode){var str=decodeURI(url),res=parser[strictMode||false?"strict":"loose"].exec(str),uri={attr:{},param:{},seg:{}},i=14;while(i--){uri.attr[key[i]]=res[i]||""}uri.param['query']={};uri.param['fragment']={};uri.attr['query'].replace(querystring_parser,function($0,$1,$2){if($1){uri.param['query'][$1]=$2}});uri.attr['fragment'].replace(fragment_parser,function($0,$1,$2){if($1){uri.param['fragment'][$1]=$2}});uri.seg['path']=uri.attr.path.replace(/^\/+|\/+$/g,'').split('/');uri.seg['fragment']=uri.attr.fragment.replace(/^\/+|\/+$/g,'').split('/');uri.attr['base']=uri.attr.host?uri.attr.protocol+"://"+uri.attr.host+(uri.attr.port?":"+uri.attr.port:''):'';return uri};function getAttrName(elm){var tn=elm.tagName;if(tn!==undefined)return tag2attr[tn.toLowerCase()];return tn}$.fn.url=function(strictMode){var url='';if(this.length){url=$(this).attr(getAttrName(this[0]))||''}return $.url(url,strictMode)};$.url=function(url,strictMode){if(arguments.length===1&&url===true){strictMode=true;url=undefined}strictMode=strictMode||false;url=url||window.location.toString();return{data:parseUri(url,strictMode),attr:function(attr){attr=aliases[attr]||attr;return attr!==undefined?this.data.attr[attr]:this.data.attr},param:function(param){return param!==undefined?this.data.param.query[param]:this.data.param.query},fparam:function(param){return param!==undefined?this.data.param.fragment[param]:this.data.param.fragment},segment:function(seg){if(seg===undefined){return this.data.seg.path}else{seg=seg<0?this.data.seg.path.length+seg:seg-1;return this.data.seg.path[seg]}},fsegment:function(seg){if(seg===undefined){return this.data.seg.fragment}else{seg=seg<0?this.data.seg.fragment.length+seg:seg-1;return this.data.seg.fragment[seg]}}}}})(jQuery);
  
</script>
</body>
</html>